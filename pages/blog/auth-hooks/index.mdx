import PostFull from '../../../components/PostFull';

export const meta = {
    title: 'react authentication hook',
    description: 'authentication hook for react with async/sync actions',
    date: new Date(2020, 9, 28, 20, 0),
    readTime: 10,
    category: 'react',
    hero: '/static/hook.png',
}

export default ({ children }) => <PostFull meta={meta}>{children}</PostFull>;

## what're we making

a great use case for using React's context and hook api is to create an authentication component. inn this post we'll create a flexible react module that executes callbacks in response to a user's status.

first, let's spec out some requirements and assumptions:

### requirements

- works for server side rendering and client transitions
- supports a variety of user statuses (blocked, missing strong auth, ...)
- does not flash unauthorized content before taking an action
- supports timer based strong authentication[^1]
- minimal external dependencies

### assumptions

- server will make a user authentication api call pre-rendering react
- apis are properly protected regardless of frontend views; frontend authorization makes for a better user experience
- browser can trust the initial server side auth api call and does not have to re-auth

## creating the provider

first, let's make our auth context and auth provider. we'll initialize the context with the results of an api call before rendering.

```
/**
* context.js
**/

import React, { createContext } from 'react';

export const AuthContext = createContext({
    user: {
        loggedIn: false,
        isTwoFactorEnabled: false,
        isTwoFactorAuthenticated: false,
        isStrongAuthenticated: false,
        isBlocked: false,
    },
    strongAuthenticationExpirationDate: 0,
    signign: () => undefined,
    signout: () => undefined,
    refreshExpirationDate: () => undefined,
});

export const createAuthProvider = (args) => {
    return ({ children }) => {
        const [user, setUser] = useState(args.user);
        const [strongAuthenticationExpirationDate, setStrongAuthenticationExpirationDate] = useState(args.strongAuthenticationExpirationDate);
        const signin = (user) => setUser(user);
        const signout = () => setUser({
            loggedIn: false,
            isTwoFactorEnabled: false,
            isTwoFactorAuthenticated: false,
            isStrongAuthenticated: false,
            isBlocked: false,
        });

        const refreshExpirationDate = (newDate) => {
            setSessionExpirationDate(newDate);
        };

        const auth = {
            user,
            signin,
            signout,
            strongAuthenticationExpirationDate,
            refreshExpirationDate,
        };

        return <AuthContext.Provider value={auth}>{children}</AuthContext.Provider>;
    }
}
```

## the hook


[^1]: authentication that requires a user has typed their password within the last X minutes.